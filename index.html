<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
	<!-- Viewport meta etiketini g√ºncelleyin -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0">
		<!-- Mobil dokunmatik √∂zellikleri -->
	<meta name="theme-color" content="#ffffff">
	<link rel="sitemap" type="application/xml" href="https://3bevreni.vercel.app/sitemap.xml">
    <script>
        // Sayfa URL'sini al
        let pageUrl = window.location.href;

        // Canonical link etiketini bul ve g√ºncelle
        let canonicalLink = document.querySelector('link[rel="canonical"]');
        if (canonicalLink) {
            canonicalLink.setAttribute('href', pageUrl);
        } else {
            // Canonical link yoksa, yeni bir tane ekle
            let newCanonical = document.createElement('link');
            newCanonical.setAttribute('rel', 'canonical');
            newCanonical.setAttribute('href', pageUrl);
            document.head.appendChild(newCanonical);
        }
    </script>

	<meta http-equiv="X-Content-Type-Options" content="nosniff">

	<!-- Mevcut meta etiketlerin g√ºncellenmi≈ü hali -->
	<meta name="description" content="3B Evreni - √ñzel tasarƒ±m 3D baskƒ± araba modelleri, koleksiyonluk fig√ºrler ve ev dekor √ºr√ºnleri. Y√ºksek kaliteli ki≈üiye √∂zel 3D baskƒ± √ß√∂z√ºmleri ile benzersiz √ºr√ºnler.">
	<meta name="keywords" content="3d baskƒ±, 3d yazƒ±cƒ±, √∂zel tasarƒ±m araba modeli, koleksiyon fig√ºr√º, 3d ev dekorasyonu, ki≈üiye √∂zel hediye, 3d baskƒ± Isparta, 3d fig√ºr fiyatlarƒ±">

	<!-- Yeni eklenen meta etiketler -->
	<meta name="geo.region" content="TR-32" />
	<meta name="geo.placename" content="Isparta" />
	<meta name="geo.position" content="37.756470; 30.566073" />
	<meta name="ICBM" content="37.756470, 30.566073" />
	
    <meta name="author" content="3B Evreni - Tuncay Yƒ±ldƒ±rƒ±m">  
    <meta name="publisher" content="3B Evreni - Tuncay Yƒ±ldƒ±rƒ±m">
    <meta name="robots" content="index, follow, max-image-preview:large">

    <link rel="icon" type="image/jpeg" href="https://cdn.shopier.app/logo_468/3bevreni_0acf1ed21753a6db010cf388af3ead50.jpg">
	
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://3bevreni.vercel.app/">
    <meta property="og:title" content="3B Evreni - √ñzel 3D Baskƒ± √úr√ºnleri">
    <meta property="og:description" content="Araba modelleri, fig√ºrler ve ev dekorlarƒ± i√ßin kaliteli 3D baskƒ± √ß√∂z√ºmleri.">
    <meta property="og:image" content="https://cdn.shopier.app/logo_468/3bevreni_0acf1ed21753a6db010cf388af3ead50.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://3bevreni.vercel.app/">
    <meta property="twitter:title" content="3B Evreni - √ñzel 3D Baskƒ± √úr√ºnleri">
    <meta property="twitter:description" content="Araba modelleri, fig√ºrler ve ev dekorlarƒ± i√ßin kaliteli 3D baskƒ± √ß√∂z√ºmleri.">
    <meta property="twitter:image" content="https://cdn.shopier.app/logo_468/3bevreni_0acf1ed21753a6db010cf388af3ead50.jpg">

    <title>3B Evreni - 3D Baskƒ± Araba Modelleri, Fig√ºrler ve Dekor √úr√ºnleri</title>
    
    <!-- Preload √∂nemli kaynaklar -->
    <link rel="preload" href="https://cdn.shopier.app/logo_468/3bevreni_0acf1ed21753a6db010cf388af3ead50.jpg" as="image">
    <link rel="preconnect" href="https://sheets.googleapis.com">
    <link rel="dns-prefetch" href="https://sheets.googleapis.com">

	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-CW05QPYXS3"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-CW05QPYXS3');
	</script>
		
	<!-- WebSite Schema -->
	<script type="application/ld+json">
	{
	  "@context": "https://schema.org",
	  "@type": "WebSite",
	  "name": "3B Evreni",
	  "url": "https://3bevreni.vercel.app",
	  "potentialAction": {
		"@type": "SearchAction",
		"target": "https://3bevreni.vercel.app?search={search_term_string}",
		"query-input": "required name=search_term_string"
	  }
	}
	</script>

	<!-- BreadcrumbList Schema -->
	<script type="application/ld+json">
	{
	  "@context": "https://schema.org",
	  "@type": "BreadcrumbList",
	  "itemListElement": [
		{
		  "@type": "ListItem",
		  "position": 1,
		  "name": "Ana Sayfa",
		  "item": "https://3bevreni.vercel.app"
		},
		{
		  "@type": "ListItem",
		  "position": 2,
		  "name": "√úr√ºnler",
		  "item": "https://3bevreni.vercel.app/urunler"
		}
	  ]
	}
	</script>

	<!-- Organization Schema -->
	<script type="application/ld+json">
	{
	  "@context": "https://schema.org",
	  "@type": "Organization",
	  "name": "3B Evreni",
	  "url": "https://3bevreni.vercel.app",
	  "logo": "https://cdn.shopier.app/logo_468/3bevreni_0acf1ed21753a6db010cf388af3ead50.jpg",
	  "sameAs": [
		"https://www.instagram.com/3bevreni",
		"https://www.facebook.com/3bevreni"
	  ]
	}
	</script>
	
    <!-- Critical CSS -->
    <style>
        /* Above-the-fold stilleri */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }
        .filters {
            padding: 10px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .product-card {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .product-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>

    
    <style>
	
        /* Geri kalan CSS stilleri */
        body {
            font-size: 16px;
            line-height: 1.5;
        }

        h1 {
            font-size: 32px;
            text-align: center;
            padding: 20px 0;
            color: #333;
        }

        .filters select, .filters input {
            padding: 10px;
            font-size: 1em;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: border 0.3s ease;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            padding: 10px;
        }

        .product-card {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 10px;
            border-radius: 8px;
            width: 375px;
            background-color: #fff;
            box-sizing: border-box;
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .product-image {
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            margin: auto;
            border-radius: 6px;
        }

        .product-image img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        .product-name {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
            text-align: center;
            height: 30px;
        }

        .product-price {
            font-size: 1.1em;
            color: #e74c3c;
            margin: 10px 0;
        }

        .product-description {
            font-size: 0.9em;
            color: #555;
            margin: 0;
            height: 110px;
        }

        .product-link {
            display: inline-block;
            padding: 10px 20px;
            background-color: #3498db;
            color: #fff;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            text-align: center;
            margin-top: auto;
			cursor:	pointer;
        }

        .product-link:hover {
            background-color: #2980b9;
        }

        .category-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 32px;
            height: 32px;
            background-size: contain;
            background-repeat: no-repeat;
            transition: transform 0.3s ease;
        }

        .category-icon:hover {
            transform: scale(1.1);
        }

        .arac-modelleri::before { content: 'üöó'; font-size: 22px; }
        .koleksiyon-figurleri::before { content: 'üèÜ'; font-size: 22px; }
        .ev-dekorasyonu::before { content: 'üè†'; font-size: 22px; }
        .hediye-ve-ozel-tasarimlar::before { content: 'üé®'; font-size: 22px; }
        .ofis-aksesuarlar::before { content: 'üî©'; font-size: 22px; }
        .anahtarliklar::before { content: 'üëú'; font-size: 22px; }

		/* Modal stilleri - Basit Kaydƒ±rƒ±labilir Versiyon */
		.modal {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.8);
			z-index: 1000;
			display: none;
			overflow: auto; /* Ana modal container kaydƒ±rƒ±labilir */
			-webkit-overflow-scrolling: touch; /* iOS i√ßin smooth scroll */
			padding-top: 50px;
		}

		.modal-content {
			background: white;
			margin: 20px auto;
			padding: 20px;
			width: 90%;
			max-width: 600px;
			border-radius: 10px;
			position: relative;
			max-height: 80vh; /* ƒ∞√ßerik y√ºksekliƒüini sƒ±nƒ±rla */
			overflow-y: auto; /* ƒ∞√ßerik kaydƒ±rƒ±labilir */
		}

        .close {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 24px;
            cursor: pointer;
        }
        .buy-button {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #ff6600;
            color: #fff;
            text-decoration: none;
            border-radius: 6px;
        }
		
		.share-button {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #007bff;
            color: #fff;
            text-decoration: none;
            border-radius: 6px;
        }
		
/* Mobil cihazlar i√ßin optimize */
@media (max-width: 768px) {

		.modal {
			padding-top: 0;
		}

    .modal-content {
        width: 90%;
        max-height: 100%; /* Mobilde daha fazla alan kaplasƒ±n */
        margin: 5px auto;
        padding: 15px;
		height: 94%;
    }
    
    .close {
        top: 5px;
        right: 10px;
        font-size: 20px;
    }
	body {
		font-size: 14px;
	}
	h1 {
		font-size: 24px;
		padding: 0;
	}
		.product-card {
		width: 100%;
		max-width: 350px;
	}
	.filters select, .filters input {
		padding: 4px;
		font-size: 0.9em;
		margin: 2px;
		border: 1px solid #ccc;
		border-radius: 3px;
		transition: border 0.3s ease;
	}
}

    </style>
</head>
<body>
    <h1>3B Evreni - 3D Baskƒ± Hizmetleri</h1>
    
    <div class="filters">
        <input type="text" id="searchInput" placeholder="√úr√ºn ara..." aria-label="√úr√ºn arama">
        <select id="categoryFilter" aria-label="Kategori filtreleme">
            <option value="">T√ºm Kategoriler</option>
        </select>

        <select id="sortOptions" aria-label="Sƒ±ralama se√ßenekleri">
            <option value="default" selected>Varsayƒ±lan</option>
            <option value="newest">Yeni Eklenen</option>
            <option value="priceLowHigh">Fiyat: Artan</option>
            <option value="priceHighLow">Fiyat: Azalan</option>
        </select>
    </div>

    <div class="container" id="productContainer" role="list"></div>

    <div id="productModal" class="modal" style="display:none;" aria-hidden="true">
        <div class="modal-content">
            <span class="close" aria-label="Kapat">&times;</span>
            <div id="modalProductDetail" role="document">Y√ºkleniyor...</div>
        </div>
    </div>

<footer style="background-color: #333333;color: white;text-align: center;padding: 15px 0;position: relative;width: 100%;font-size: 14px;box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);">
  ¬© 2022 - <span id="currentYear"></span> <a target="_blank" style="color: #ffcc00;" href="https://tuncyyldrm.vercel.app" >Tuncay YILDIRIM</a>
</footer>

    <script>
        // API konfig√ºrasyonu
        const apiKey = 'AIzaSyCQ_SmNuv0JxBBtaiSi7LGxPmeqOPygjYc';
        const spreadsheetId = '1RaU1SPiCDU9AkAUoQbn2pEn_K9S4TZJXeli8ZTJsHek';
        const range = 'Stok!A2:H';
        const sheetUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
        
        // Global deƒüi≈ükenler
        let products = [];
        let filteredProducts = [];
        const productsPerPage = 12;
        let currentPage = 1;
        let isLoading = false;
		let originalTitle = document.title;
        
        // Veri y√ºkleme ve √∂nbellekleme
        let productsCache = null;
        let lastFetchTime = 0;

        async function fetchProducts() {
            const now = Date.now();
            // 5 dakika √∂nbellek s√ºresi
            if (productsCache && now - lastFetchTime < 300000) {
                return productsCache;
            }

            try {
                const response = await fetch(sheetUrl);
                const data = await response.json();
                
                if (!data.values) throw new Error('Veri alƒ±namadƒ±');
                
                productsCache = data.values.map(row => {
                    const price = parseFloat(row[6]?.replace(',', '.') || '0');
                    return {
                        id: row[0],
                        categoryCode: row[1],
                        name: row[2],
                        description: row[3],
                        buyLink: row[4],
                        addedDate: row[5],
                        price: isNaN(price) ? 0 : price,
                        imageUrl: row[7] || '',
                        slug: slugify(row[2])
                    };
                });
                
                lastFetchTime = now;
                return productsCache;
            } catch (error) {
                console.error('Veri √ßekme hatasƒ±:', error);
                throw error;
            }
        }

        // Slugify fonksiyonu
        function slugify(text) {
            return text.toString().toLowerCase()
                .replace(/[√ßƒüƒ±√∂≈ü√º]/g, function(match) {
                    switch (match) {
                        case '√ß': return 'c';
                        case 'ƒü': return 'g';
                        case 'ƒ±': return 'i';
                        case '√∂': return 'o';
                        case '≈ü': return 's';
                        case '√º': return 'u';
                    }
                })
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/--+/g, '-')
                .trim();
        }

        // Kategori se√ßeneklerini render et
        function renderCategoryOptions() {
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="">T√ºm Kategoriler</option>';

            const categories = [...new Set(products.map(product => product.categoryCode))];
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category
                    .split('-')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');
                categoryFilter.appendChild(option);
            });

            // URL'deki kategori parametresine g√∂re se√ßimi ayarla
            const urlParams = new URLSearchParams(window.location.search);
            const selectedCategory = urlParams.get('category') || '';
            categoryFilter.value = selectedCategory;
        }

        // √úr√ºn kartƒ± olu≈ütur
        function renderProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.setAttribute('itemscope', '');
            card.setAttribute('itemtype', 'https://schema.org/Product');
            
            card.innerHTML = `
                <div class="category-icon ${product.categoryCode}" aria-label="${product.categoryCode}"></div>
                <div class="product-image">
                    <img itemprop="image" 
                         src="${product.imageUrl}" 
                         alt="${product.name}" 
                         loading="lazy"
                         width="300" 
                         height="300"
                         onerror="this.src='https://cdn.shopier.app/logo_468/3bevreni_0acf1ed21753a6db010cf388af3ead50.jpg'">
                </div>
                <h2 itemprop="name" class="product-name">${product.name}</h2>
                <div itemprop="offers" itemscope itemtype="https://schema.org/Offer" class="product-price">
                    <span itemprop="price" content="${product.price}">${product.price.toFixed(2)}</span>
                    <span itemprop="priceCurrency" content="TRY">TL</span>
                </div>
                <p itemprop="description" class="product-description">
                    ${product.description || 'A√ßƒ±klama bulunmamaktadƒ±r.'}
                </p>
                <button class="product-link" onclick="showProductDetailByName('${product.slug}')">Detay</button>
                <meta itemprop="url" content="https://3bevreni.vercel.app/?urun=${product.slug}">
            `;
            
            return card;
        }

        // √úr√ºnleri render et
        function renderProducts() {
            const container = document.getElementById('productContainer');
            
            if (currentPage === 1) {
                container.innerHTML = '';
            }

            const start = (currentPage - 1) * productsPerPage;
            const end = start + productsPerPage;
            
            if (start >= filteredProducts.length) return;

            const currentProducts = filteredProducts.slice(start, end);
            const fragment = document.createDocumentFragment();

            currentProducts.forEach(product => {
                const card = renderProductCard(product);
                fragment.appendChild(card);
            });

            container.appendChild(fragment);
            updateURLParams();
            
            // Lazy loading i√ßin g√∂zlemciyi ba≈ülat
            initLazyLoading();
            
            // Animasyonlarƒ± tetikle
            animateCards();
        }

        // Intersection Observer ile lazy loading
        function initLazyLoading() {
            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            if (img.dataset.src) {
                                img.src = img.dataset.src;
                            }
                            observer.unobserve(img);
                        }
                    });
                }, { rootMargin: '200px' });

                document.querySelectorAll('img[loading="lazy"]').forEach(img => {
                    observer.observe(img);
                });
            }
        }

        // Kart animasyonlarƒ±
        function animateCards() {
            const cards = document.querySelectorAll('.product-card');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            cards.forEach(card => observer.observe(card));
        }

		// Sayfa ge√ßmi≈ü y√∂netimi i√ßin geli≈ütirilmi≈ü kod
		let isInitialLoad = true;

		window.addEventListener('pageshow', function(event) {
			// Sayfa √∂nbellekten y√ºklenirse veya geri/ileri tu≈üuyla gelinirse
			if (event.persisted || performance.navigation.type === 2) {
				currentPage = 1;
				if (window.location.search.includes('urun=')) {
					// URL'de name parametresi varsa direkt detay sayfasƒ±nƒ± g√∂ster
					const nameParam = new URLSearchParams(window.location.search).get('urun');
					showProductDetailByName(nameParam);
				} else {
					// Yoksa filtreleri uygula
					applyFilters();
				}
			}
			
			// ƒ∞lk y√ºkleme kontrol√º
			if (isInitialLoad) {
				isInitialLoad = false;
				checkURLParamsAndApplyFilters();
			}
		});
		
		// Sayfa y√ºklendiƒüinde ba≈ülangƒ±√ß state'i ve scroll pozisyonunu kaydet
		let lastScrollPosition = 0;
		history.replaceState({ modalClosed: true, scrollY: window.scrollY }, "");
				
		// Global tanƒ±m
		let currentProduct = null;

		// √úr√ºn detayƒ±nƒ± g√∂ster
		function showProductDetailByName(slugName) {
			lastScrollPosition = window.scrollY;
			document.body.style.overflow = 'hidden';

			if (products.length === 0) {
				console.error('√úr√ºn listesi hen√ºz y√ºklenmedi!');
				return;
			}

			if (!slugName) {
				console.error('Ge√ßerli bir √ºr√ºn adƒ± parametresi bulunamadƒ±!');
				return;
			}

			const product = products.find(p => p.slug === slugName);

			if (!product) {
				console.error(`√úr√ºn bulunamadƒ±: ${slugName}`);
				const modal = document.getElementById('productModal');
				const modalContent = document.getElementById('modalProductDetail');
				modalContent.innerHTML = '<p>√úr√ºn bulunamadƒ±.</p>';
				modal.style.display = 'block';
				return;
			}

			// currentProduct'ƒ± g√ºncelle
			currentProduct = product;

			const modal = document.getElementById('productModal');
			const modalContent = document.getElementById('modalProductDetail');

			sessionStorage.setItem('scrollPosition', window.scrollY);

			// Schema markup ekle
			const schemaScript = document.createElement('script');
			schemaScript.type = 'application/ld+json';
			schemaScript.textContent = JSON.stringify({
				"@context": "https://schema.org",
				"@type": "Product",
				"name": product.name,
				"description": product.description,
				"image": product.imageUrl,
				"offers": {
					"@type": "Offer",
					"price": product.price,
					"priceCurrency": "TRY",
					"url": window.location.href,
					"availability": "https://schema.org/InStock"
				}
			});
			document.head.appendChild(schemaScript);

			modalContent.innerHTML = ` 
				<h2 itemprop="name">${product.name}</h2>
				<img itemprop="image" src="${product.imageUrl}" alt="${product.name}" 
					 style="width:100%; max-height:300px; object-fit:contain;" 
					 onerror="this.src='https://cdn.shopier.app/logo_468/3bevreni_0acf1ed21753a6db010cf388af3ead50.jpg'">
				<div itemprop="offers" itemscope itemtype="https://schema.org/Offer">
					<p><strong>Fiyat:</strong> <span itemprop="price" content="${product.price}">${product.price.toFixed(2)}</span> <span itemprop="priceCurrency" content="TRY">TL</span></p>
				</div>
				<p itemprop="description"><strong>A√ßƒ±klama:</strong> ${product.description || 'A√ßƒ±klama bulunmamaktadƒ±r.'}</p>
				<a href="${product.buyLink}" target="_blank" class="buy-button" itemprop="url">Satƒ±n Al</a>
				<!-- Sosyal payla≈üƒ±m butonu -->
				<a href="javascript:void(0)" onclick="shareProduct()" class="share-button">Payla≈ü</a>
			`;

			modal.style.display = 'block';
			modal.setAttribute('aria-hidden', 'false');
			document.title = `√úr√ºn Detayƒ± - ${product.name}`;
			history.replaceState(null, '', `?urun=${slugName}`);
			if (typeof gtag !== 'undefined') {
				gtag('event', 'page_view', {
					page_title: `√úr√ºn Detayƒ± - ${product.name}`,
					page_location: window.location.href,
					page_path: window.location.pathname + window.location.search
				});

				gtag('event', 'view_item', {
					items: [{
						id: product.id,
						name: product.name,
						category: product.categoryCode,
						price: product.price,
						currency: 'TRY'
					}]
				});
			}

			history.pushState({ modalOpen: true, scrollY: lastScrollPosition }, "", `?urun=${slugName}`);
		}

		// √úr√ºn payla≈üƒ±mƒ±
		function shareProduct() {
		  if (!currentProduct) {
			console.error("Payla≈üƒ±lacak √ºr√ºn bilgisi bulunamadƒ±.");
			return;
		  }

		  const shareData = {
			title: currentProduct.name,
			text: currentProduct.description,
			url: window.location.href
		  };

		  if (navigator.share) {
			navigator.share(shareData)
			  .then(() => console.log('Payla≈üƒ±m ba≈üarƒ±lƒ±.'))
			  .catch((error) => console.log('Payla≈üƒ±m iptal edildi veya ba≈üarƒ±sƒ±z:', error));
		  } else {
			// Geriye d√º≈üen √ß√∂z√ºm: linki kopyala
			navigator.clipboard.writeText(shareData.url).then(() => {
			  alert("Payla≈üƒ±m bu ortamda desteklenmiyor.\nBaƒülantƒ± panoya kopyalandƒ±:\n" + shareData.url);
			});
		  }
		}

		// Modal kapatma fonksiyonunu g√ºncelle
		function closeModal() {
			document.getElementById('productModal').style.display = 'none';
			document.body.style.overflow = 'auto';
			document.getElementById('productModal').setAttribute('aria-hidden', 'true');
			
			// URL'den 'urun' parametresini kaldƒ±r
			const params = new URLSearchParams(window.location.search);
			params.delete('urun');
			const newUrl = params.toString() ? `?${params.toString()}` : window.location.pathname;
			history.replaceState(null, '', newUrl);

			// Sayfa ba≈ülƒ±ƒüƒ±nƒ± geri y√ºkle
			document.title = originalTitle;

			// Eƒüer √ºr√ºn listesi bo≈üsa yeniden y√ºkle
			if (document.getElementById('productContainer').children.length === 0) {
				currentPage = 1;
				applyFilters();
			}
		}

        // Filtreleme fonksiyonu
        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value.toLowerCase();
            const sortOption = document.getElementById('sortOptions').value;

            filteredProducts = products.filter(product => {
                const matchesSearch =
                    product.name.toLowerCase().includes(search) ||
                    (product.description && product.description.toLowerCase().includes(search));

                const matchesCategory = category ? 
                    product.categoryCode.toLowerCase() === category : true;

                return matchesSearch && matchesCategory;
            });

            // Sƒ±ralama i≈ülemleri
            const parseDate = (dateStr) => {
                if (!dateStr || !dateStr.includes('.')) return new Date(0);
                const [day, month, year] = dateStr.split('.');
                return new Date(`${year}-${month}-${day}`);
            };

            if (sortOption === 'newest') {
                filteredProducts.sort((a, b) => parseDate(b.addedDate) - parseDate(a.addedDate));
            } else if (sortOption === 'priceLowHigh') {
                filteredProducts.sort((a, b) => a.price - b.price);
            } else if (sortOption === 'priceHighLow') {
                filteredProducts.sort((a, b) => b.price - a.price);
            }

            window.scrollTo(0, 0);
            currentPage = 1;
            renderProducts();
        }

        // URL parametrelerini g√ºncelle
        function updateURLParams() {
            const params = new URLSearchParams();
            const search = document.getElementById('searchInput').value;
            const category = document.getElementById('categoryFilter').value;
            const sort = document.getElementById('sortOptions').value;

            if (search) params.set('search', search);
            if (category) params.set('category', category);
            if (sort && sort !== 'newest') params.set('sort', sort);
            if (currentPage > 1) params.set('page', currentPage);

            const existingName = new URLSearchParams(window.location.search).get('urun');
            if (existingName) params.set('urun', existingName);

            const newUrl = params.toString() ? `?${params.toString()}` : window.location.pathname;
            history.replaceState(null, '', newUrl);
        }

		// URL parametrelerini kontrol et ve filtreleri uygula
		function checkURLParamsAndApplyFilters() {
			const params = new URLSearchParams(window.location.search);
			
			document.getElementById('searchInput').value = params.get('search') || '';
			document.getElementById('categoryFilter').value = params.get('category') || '';
			document.getElementById('sortOptions').value = params.get('sort') || 'newest';
			currentPage = parseInt(params.get('page')) || 1;

			const nameParam = params.get('urun');
			if (nameParam) {
				// Sayfa kaydƒ±rma pozisyonunu sakla
				sessionStorage.setItem('scrollPosition', window.scrollY);
				showProductDetailByName(nameParam);
				
			} else {
				applyFilters();
			}
		}

        // Sayfa y√ºklendiƒüinde
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                products = await fetchProducts();
                filteredProducts = [...products];
                renderCategoryOptions();
                checkURLParamsAndApplyFilters();
                
                // Event listener'larƒ± ekle
                document.getElementById('searchInput').addEventListener('input', 
                    debounce(applyFilters, 300));
                document.getElementById('categoryFilter').addEventListener('change', applyFilters);
                document.getElementById('sortOptions').addEventListener('change', applyFilters);
                document.querySelector('.modal .close').addEventListener('click', closeModal);
                
                // Sonsuz kaydƒ±rma
                window.addEventListener('scroll', () => {
                    if (isLoading) return;
                    
                    const scrollThreshold = 100;
                    const maxPage = Math.ceil(filteredProducts.length / productsPerPage);
                    
                    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - scrollThreshold && 
                        currentPage < maxPage) {
                        isLoading = true;
                        currentPage++;
                        renderProducts();
                        isLoading = false;
                    }
                });
                
                // ESC ile modal kapatma
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape') {
                        closeModal();
                    }
                });
                
                // Dƒ±≈üarƒ± tƒ±klayarak modal kapatma
                document.getElementById('productModal').addEventListener('click', (event) => {
                    if (event.target === document.getElementById('productModal')) {
                        closeModal();
                    }
                });
                
            } catch (error) {
                console.error('Ba≈ülatma hatasƒ±:', error);
                document.getElementById('productContainer').innerHTML = 
                    `<p style="color:red">Veri alƒ±namadƒ±. L√ºtfen daha sonra tekrar deneyiniz.</p>`;
            }
        });

        // Debounce fonksiyonu
        function debounce(func, wait) {
            let timeout;
            return function() {
                const context = this, args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    func.apply(context, args);
                }, wait);
            };
        }
		
		// Sayfa y√ºklendiƒüinde ba≈ülangƒ±√ß state'i ekle (isteƒüe baƒülƒ±)
		history.pushState({ modalClosed: true }, "", "");

		// Geri tu≈üu dinleyici (optimize edilmi≈ü versiyon)
		window.addEventListener("popstate", function(event) {
			const modal = document.getElementById('productModal');
			
			if (modal && modal.style.display === 'block') {
				// Modalƒ± kapat
				closeModal();
				
				// Kayƒ±tlƒ± scroll pozisyonunu al (state'ten veya global deƒüi≈ükenden)
				const scrollY = event.state?.scrollY || lastScrollPosition;
				
				// Scroll pozisyonunu geri y√ºkle (setTimeout ile g√ºvenli ≈üekilde)
				setTimeout(() => {
					window.scrollTo(0, scrollY);
				}, 10);
				
				// Yeni state eklerken scroll pozisyonunu da kaydet
				history.replaceState({ modalClosed: true, scrollY: scrollY }, "");
			}
		});
    </script>
</body>
</html>
